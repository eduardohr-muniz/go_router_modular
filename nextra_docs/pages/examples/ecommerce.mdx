# üõçÔ∏è E-commerce App Example

Exemplo completo de uma aplica√ß√£o de e-commerce usando GoRouter Modular com arquitetura modular.

## üèóÔ∏è Estrutura da Aplica√ß√£o

```
e_commerce_app/
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ main.dart
‚îÇ   ‚îú‚îÄ‚îÄ app_module.dart
‚îÇ   ‚îî‚îÄ‚îÄ modules/
‚îÇ       ‚îú‚îÄ‚îÄ auth/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ auth_module.dart
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ pages/
‚îÇ       ‚îú‚îÄ‚îÄ products/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ product_module.dart
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ pages/
‚îÇ       ‚îú‚îÄ‚îÄ cart/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ cart_module.dart
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ pages/
‚îÇ       ‚îî‚îÄ‚îÄ checkout/
‚îÇ           ‚îú‚îÄ‚îÄ checkout_module.dart
‚îÇ           ‚îî‚îÄ‚îÄ pages/
```

## üöÄ Configura√ß√£o Principal

```dart
// main.dart
import 'package:flutter/material.dart';
import 'package:go_router_modular/go_router_modular.dart';
import 'app_module.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  
  await GoRouterModular.configure(
    appModule: AppModule(),
    initialRoute: '/home',
    debugLogEventBus: true,
  );
  
  runApp(ECommerceApp());
}

class ECommerceApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp.router(
      title: 'E-commerce Modular',
      routerConfig: GoRouterModular.routerConfig,
      theme: ThemeData(
        primarySwatch: Colors.blue,
        visualDensity: VisualDensity.adaptivePlatformDensity,
      ),
    );
  }
}
```

## üì¶ M√≥dulo Principal

```dart
// app_module.dart
import 'package:go_router_modular/go_router_modular.dart';
import 'modules/auth/auth_module.dart';
import 'modules/products/product_module.dart';
import 'modules/cart/cart_module.dart';
import 'modules/checkout/checkout_module.dart';

class AppModule extends Module {
  @override
  List<ModularRoute> get routes => [
    // Rota inicial
    ChildRoute('/', child: (context, state) => SplashPage()),
    ChildRoute('/home', child: (context, state) => HomePage()),
    
    // M√≥dulos de funcionalidades
    ModuleRoute('/auth', module: AuthModule()),
    ModuleRoute('/products', module: ProductModule()),
    ModuleRoute('/cart', module: CartModule()),
    ModuleRoute('/checkout', module: CheckoutModule()),
  ];

  @override
  void binds(Injector i) {
    // Servi√ßos globais
    i.addSingleton<ApiService>(ApiService.new);
    i.addSingleton<AuthService>(AuthService.new);
    i.addSingleton<CartService>(CartService.new);
    i.addSingleton<NavigationService>(NavigationService.new);
  }
}
```

## üõí M√≥dulo de Produtos

```dart
// modules/products/product_module.dart
import 'package:go_router_modular/go_router_modular.dart';

class ProductModule extends EventModule {
  @override
  List<ModularRoute> get routes => [
    ChildRoute('/', child: (context, state) => ProductListPage()),
    ChildRoute('/:id', child: (context, state) => ProductDetailPage(
      productId: state.pathParameters['id']!,
    )),
    ChildRoute('/category/:category', child: (context, state) => CategoryPage(
      category: state.pathParameters['category']!,
    )),
  ];

  @override
  void binds(Injector i) {
    i.addSingleton<ProductRepository>(ProductRepository.new);
    i.addFactory<ProductBloc>(ProductBloc.new);
  }

  @override
  void listen() {
    // Escuta eventos de outros m√≥dulos
    on<UserLoginEvent>((event, context) {
      _loadUserRecommendations(event.userId);
    });

    on<AddToCartEvent>((event, context) {
      _updateProductMetrics(event.productId);
    });
  }

  void _loadUserRecommendations(String userId) {
    final productRepo = Modular.get<ProductRepository>();
    productRepo.loadRecommendations(userId);
  }

  void _updateProductMetrics(String productId) {
    // Atualizar m√©tricas do produto
    ModularEvent.fire(ProductViewedEvent(
      productId: productId,
      timestamp: DateTime.now(),
    ));
  }
}
```

## üõçÔ∏è M√≥dulo do Carrinho

```dart
// modules/cart/cart_module.dart
import 'package:go_router_modular/go_router_modular.dart';

class CartModule extends EventModule {
  @override
  List<ModularRoute> get routes => [
    ChildRoute('/', child: (context, state) => CartPage()),
    ChildRoute('/summary', child: (context, state) => CartSummaryPage()),
  ];

  @override
  void binds(Injector i) {
    i.addFactory<CartBloc>(CartBloc.new);
  }

  @override
  void listen() {
    on<AddToCartEvent>((event, context) {
      _addItemToCart(event.productId, event.quantity);
    });

    on<RemoveFromCartEvent>((event, context) {
      _removeItemFromCart(event.itemId);
    });

    on<UserLogoutEvent>((event, context) {
      _clearCart();
    });
  }

  void _addItemToCart(String productId, int quantity) {
    final cartService = Modular.get<CartService>();
    cartService.addItem(productId, quantity);
    
    // Notificar outros m√≥dulos
    ModularEvent.fire(CartUpdatedEvent(
      itemCount: cartService.itemCount,
      total: cartService.total,
    ));
  }

  void _removeItemFromCart(String itemId) {
    final cartService = Modular.get<CartService>();
    cartService.removeItem(itemId);
    
    ModularEvent.fire(CartUpdatedEvent(
      itemCount: cartService.itemCount,
      total: cartService.total,
    ));
  }

  void _clearCart() {
    final cartService = Modular.get<CartService>();
    cartService.clear();
    
    ModularEvent.fire(CartClearedEvent());
  }
}
```

## üí≥ M√≥dulo de Checkout

```dart
// modules/checkout/checkout_module.dart
import 'package:go_router_modular/go_router_modular.dart';

class CheckoutModule extends EventModule {
  @override
  List<ModularRoute> get routes => [
    ChildRoute('/', child: (context, state) => CheckoutPage()),
    ChildRoute('/payment', child: (context, state) => PaymentPage()),
    ChildRoute('/confirmation', child: (context, state) => OrderConfirmationPage()),
  ];

  @override
  void binds(Injector i) {
    i.addSingleton<PaymentService>(PaymentService.new);
    i.addSingleton<OrderService>(OrderService.new);
    i.addFactory<CheckoutBloc>(CheckoutBloc.new);
  }

  @override
  void listen() {
    on<ProcessPaymentEvent>((event, context) {
      _processPayment(event.paymentData);
    });

    on<OrderCreatedEvent>((event, context) {
      _handleOrderCreated(event.orderId);
    });
  }

  Future<void> _processPayment(PaymentData paymentData) async {
    try {
      final paymentService = Modular.get<PaymentService>();
      final result = await paymentService.processPayment(paymentData);
      
      if (result.success) {
        ModularEvent.fire(PaymentSuccessEvent(
          transactionId: result.transactionId,
          amount: paymentData.amount,
        ));
        
        // Criar pedido
        await _createOrder(paymentData);
      } else {
        ModularEvent.fire(PaymentFailedEvent(
          error: result.error,
          amount: paymentData.amount,
        ));
      }
    } catch (error) {
      ModularEvent.fire(PaymentErrorEvent(
        error: error.toString(),
      ));
    }
  }

  Future<void> _createOrder(PaymentData paymentData) async {
    final orderService = Modular.get<OrderService>();
    final cartService = Modular.get<CartService>();
    
    final order = await orderService.createOrder(
      items: cartService.items,
      paymentData: paymentData,
    );
    
    ModularEvent.fire(OrderCreatedEvent(
      orderId: order.id,
      total: order.total,
    ));
    
    // Limpar carrinho ap√≥s pedido criado
    cartService.clear();
  }

  void _handleOrderCreated(String orderId) {
    // Navegar para confirma√ß√£o
    Modular.to.pushNamed('/checkout/confirmation', arguments: orderId);
    
    // Notificar outros m√≥dulos
    ModularEvent.fire(CartClearedEvent());
  }
}
```

## üé≠ Eventos da Aplica√ß√£o

```dart
// events/app_events.dart

// Eventos de Autentica√ß√£o
class UserLoginEvent {
  final String userId;
  final String email;
  final DateTime loginTime;
  
  UserLoginEvent({
    required this.userId,
    required this.email,
    required this.loginTime,
  });
}

class UserLogoutEvent {
  final String userId;
  final DateTime logoutTime;
  
  UserLogoutEvent({
    required this.userId,
    required this.logoutTime,
  });
}

// Eventos de Carrinho
class AddToCartEvent {
  final String productId;
  final int quantity;
  
  AddToCartEvent({
    required this.productId,
    required this.quantity,
  });
}

class RemoveFromCartEvent {
  final String itemId;
  
  RemoveFromCartEvent({required this.itemId});
}

class CartUpdatedEvent {
  final int itemCount;
  final double total;
  
  CartUpdatedEvent({
    required this.itemCount,
    required this.total,
  });
}

class CartClearedEvent {}

// Eventos de Produtos
class ProductViewedEvent {
  final String productId;
  final DateTime timestamp;
  
  ProductViewedEvent({
    required this.productId,
    required this.timestamp,
  });
}

// Eventos de Pagamento
class ProcessPaymentEvent {
  final PaymentData paymentData;
  
  ProcessPaymentEvent({required this.paymentData});
}

class PaymentSuccessEvent {
  final String transactionId;
  final double amount;
  
  PaymentSuccessEvent({
    required this.transactionId,
    required this.amount,
  });
}

class PaymentFailedEvent {
  final String error;
  final double amount;
  
  PaymentFailedEvent({
    required this.error,
    required this.amount,
  });
}

class PaymentErrorEvent {
  final String error;
  
  PaymentErrorEvent({required this.error});
}

// Eventos de Pedidos
class OrderCreatedEvent {
  final String orderId;
  final double total;
  
  OrderCreatedEvent({
    required this.orderId,
    required this.total,
  });
}
```

## üè† Home Page com Navega√ß√£o

```dart
// pages/home_page.dart
import 'package:flutter/material.dart';
import 'package:go_router_modular/go_router_modular.dart';

class HomePage extends StatefulWidget {
  @override
  State<HomePage> createState() => _HomePageState();
}

class _HomePageState extends State<HomePage> {
  int _cartItemCount = 0;

  @override
  void initState() {
    super.initState();
    _listenToCartUpdates();
  }

  void _listenToCartUpdates() {
    // Escutar atualiza√ß√µes do carrinho via EventModule
    final homeModule = Modular.get<HomeModule>();
    homeModule.on<CartUpdatedEvent>((event, context) {
      setState(() {
        _cartItemCount = event.itemCount;
      });
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('E-commerce App'),
        actions: [
          IconButton(
            icon: Stack(
              children: [
                Icon(Icons.shopping_cart),
                if (_cartItemCount > 0)
                  Positioned(
                    right: 0,
                    top: 0,
                    child: Container(
                      padding: EdgeInsets.all(2),
                      decoration: BoxDecoration(
                        color: Colors.red,
                        borderRadius: BorderRadius.circular(10),
                      ),
                      constraints: BoxConstraints(
                        minWidth: 16,
                        minHeight: 16,
                      ),
                      child: Text(
                        '$_cartItemCount',
                        style: TextStyle(
                          color: Colors.white,
                          fontSize: 12,
                        ),
                        textAlign: TextAlign.center,
                      ),
                    ),
                  ),
              ],
            ),
            onPressed: () => context.go('/cart'),
          ),
        ],
      ),
      body: GridView.builder(
        padding: EdgeInsets.all(16),
        gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
          crossAxisCount: 2,
          crossAxisSpacing: 16,
          mainAxisSpacing: 16,
          childAspectRatio: 0.8,
        ),
        itemCount: categories.length,
        itemBuilder: (context, index) {
          final category = categories[index];
          return CategoryCard(
            category: category,
            onTap: () => context.go('/products/category/${category.id}'),
          );
        },
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: () => context.go('/products'),
        child: Icon(Icons.search),
        tooltip: 'Ver todos os produtos',
      ),
    );
  }
}

class CategoryCard extends StatelessWidget {
  final Category category;
  final VoidCallback onTap;
  
  const CategoryCard({
    required this.category,
    required this.onTap,
    Key? key,
  }) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Card(
      elevation: 4,
      shape: RoundedRectangleBorder(
        borderRadius: BorderRadius.circular(12),
      ),
      child: InkWell(
        onTap: onTap,
        borderRadius: BorderRadius.circular(12),
        child: Column(
          children: [
            Expanded(
              child: Container(
                decoration: BoxDecoration(
                  borderRadius: BorderRadius.vertical(top: Radius.circular(12)),
                  image: DecorationImage(
                    image: NetworkImage(category.imageUrl),
                    fit: BoxFit.cover,
                  ),
                ),
              ),
            ),
            Padding(
              padding: EdgeInsets.all(8),
              child: Text(
                category.name,
                style: Theme.of(context).textTheme.titleMedium,
                textAlign: TextAlign.center,
              ),
            ),
          ],
        ),
      ),
    );
  }
}
```

## üîÑ Fluxo de Navega√ß√£o

1. **Splash Screen** ‚Üí **Home Page**
2. **Home Page** ‚Üí **Product Categories** ‚Üí **Product List** ‚Üí **Product Detail**
3. **Product Detail** ‚Üí **Add to Cart** ‚Üí **Cart Page**
4. **Cart Page** ‚Üí **Checkout** ‚Üí **Payment** ‚Üí **Order Confirmation**

## ‚úÖ Benef√≠cios desta Arquitetura

- ‚úÖ **Modularidade**: Cada funcionalidade em seu pr√≥prio m√≥dulo
- ‚úÖ **Comunica√ß√£o**: EventModule permite comunica√ß√£o entre m√≥dulos
- ‚úÖ **Escalabilidade**: F√°cil adicionar novas funcionalidades
- ‚úÖ **Testabilidade**: Cada m√≥dulo pode ser testado independentemente
- ‚úÖ **Manutenibilidade**: C√≥digo organizado e bem estruturado
- ‚úÖ **Performance**: Lazy loading de m√≥dulos conforme necess√°rio

## üß™ Testes

```dart
// test/modules/cart/cart_module_test.dart
import 'package:flutter_test/flutter_test.dart';
import 'package:go_router_modular/go_router_modular.dart';

void main() {
  group('CartModule Tests', () {
    late CartModule cartModule;

    setUp(() {
      cartModule = CartModule();
      // Setup de depend√™ncias para teste
    });

    test('should add item to cart when AddToCartEvent is fired', () {
      // Arrange
      final event = AddToCartEvent(productId: 'product123', quantity: 2);
      
      // Act
      ModularEvent.fire(event);
      
      // Assert
      // Verificar se o item foi adicionado ao carrinho
    });

    test('should update cart count when item is added', () {
      // Teste de atualiza√ß√£o do contador
    });
  });
}
```

---

Este exemplo demonstra uma aplica√ß√£o completa de e-commerce usando GoRouter Modular, mostrando como organizar c√≥digo em m√≥dulos, comunica√ß√£o via eventos e navega√ß√£o type-safe.
